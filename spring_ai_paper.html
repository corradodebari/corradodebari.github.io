<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Render Markdown from GitHub</title>

  <!-- Highlight.js style (pick any theme you like) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">

  <style>
    :root {
      --content-width: 900px;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: #fff;
      color: #111;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
    }
    main {
      max-width: var(--content-width);
      margin: 40px auto;
      padding: 0 24px 120px;
    }
    main img { max-width: 100%; }
    main table { border-collapse: collapse; }
    main th, main td { border: 1px solid #ddd; padding: 6px 10px; }

    /* Code blocks */
    pre {
      position: relative;
      background: #f6f8fa;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 14px 16px;
      overflow: auto;
    }
    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.95em;
    }
    /* Copy button */
    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 6px 8px;
      font-size: 12px;
      border: 1px solid #d1d5db;
      background: #fff;
      border-radius: 6px;
      cursor: pointer;
      opacity: 0.85;
      transition: opacity .15s ease-in-out, transform .05s ease-in-out;
    }
    .copy-btn:hover { opacity: 1; }
    .copy-btn:active { transform: translateY(1px); }
    /* Keep button visible when block scrolls horizontally */
    pre { overflow: auto; }
  </style>
</head>
<body>
  <main id="content">Loading…</main>

  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
  <!-- Optional but recommended: sanitize HTML to avoid XSS if you don’t fully trust the source -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
  <!-- Syntax highlighting -->
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>

  <script>
    // 1) Set your raw Markdown URL here:
    const mdUrl = "https://raw.githubusercontent.com/corradodebari/corradodebari.github.io/main/AI_SpringAI_RAG_Paper_final.md";

    // 2) Configure marked + highlight.js
    marked.use({
      gfm: true,
      breaks: false,
      highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
          return hljs.highlight(code, {language: lang}).value;
        }
        return hljs.highlightAuto(code).value;
      }
    });

    // Utility: add copy buttons to each <pre><code>…</code></pre>
    function addCopyButtons(root) {
      root.querySelectorAll('pre > code').forEach(codeEl => {
        const pre = codeEl.parentElement;
        // Avoid duplicating the button if re-rendering
        if (pre.querySelector('.copy-btn')) return;

        const btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.type = 'button';
        btn.textContent = 'Copy';

        btn.addEventListener('click', async () => {
          const text = codeEl.innerText; // Preserve visible text (incl. newlines)
          try {
            await navigator.clipboard.writeText(text);
            const orig = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => (btn.textContent = orig), 1200);
          } catch (e) {
            btn.textContent = 'Failed';
            setTimeout(() => (btn.textContent = 'Copy'), 1200);
          }
        });

        pre.appendChild(btn);
      });
    }

    async function renderMarkdown() {
      const mount = document.getElementById('content');
      try {
        const res = await fetch(mdUrl, { cache: 'no-store' });
        if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
        const md = await res.text();

        // Convert markdown -> HTML
        const html = marked.parse(md);

        // Sanitize (optional but safer if remote files)
        const safe = DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });

        // Inject into the page
        mount.innerHTML = safe;

        // Highlight any code blocks that weren't highlighted by marked (defensive)
        document.querySelectorAll('pre code').forEach(block => {
          // If highlight.js hasn't processed it (no <span> children), do it now
          if (!block.querySelector('span')) {
            hljs.highlightElement(block);
          }
        });

        // Add copy buttons
        addCopyButtons(mount);
      } catch (err) {
        mount.textContent = `Could not load Markdown: ${err}`;
      }
    }

    renderMarkdown();
  </script>
</body>
</html>
